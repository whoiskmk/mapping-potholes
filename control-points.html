
<!DOCTYPE html>
<html>
<head>
    <title>MapQuest Leaflet plugin with Control Point Routing</title>
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>-->


    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
    <script src="http://www.mapquestapi.com/sdk/leaflet/v2.s/mq-map.js?key=CI6VvHdudeE9WTpCx0ptrvgzJGSiOYYW"></script>
    <script src="//www.mapquestapi.com/sdk/leaflet/v2.2/mq-routing.js?key=CI6VvHdudeE9WTpCx0ptrvgzJGSiOYYW"></script>

    <link rel="stylesheet" href="//leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="//leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <script type="text/javascript" src="//leaflet.github.io/Leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    <script type="text/javascript" src="//www.mapquestapi.com/sdk/leaflet/v2.s/mq-map.js?key=CI6VvHdudeE9WTpCx0ptrvgzJGSiOYYW"></script>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>

    <script src="//www.mapquestapi.com/sdk/leaflet/v2.2/mq-map.js?key=CI6VvHdudeE9WTpCx0ptrvgzJGSiOYYW"></script>
    <script src="//www.mapquestapi.com/sdk/leaflet/v2.2/mq-routing.js?key=CI6VvHdudeE9WTpCx0ptrvgzJGSiOYYW"></script>


    <script src="js/leaflet.geocsv.js"></script>
    <script src="https://unpkg.com/leaflet.featuregroup.subgroup@1.0.2/dist/leaflet.featuregroup.subgroup-src.js"></script>

    <!--<title>Leaflet Pothole Clusters</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
  <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">

  <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="leaflet.featuregroup.subgroup.js"></script>


    <script type='text/javascript' src='http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js'></script>
     <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/leaflet.markercluster.js'></script>

    <link rel="stylesheet" href="//unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <script type="text/javascript" src="//unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>




    <link rel="stylesheet" href="//leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <script type="text/javascript" src="//leaflet.github.io/Leaflet.markercluster/dist/leaflet.markercluster.js"></script>

    <script src="http://www.mapquestapi.com/sdk/js/v7.2.s/mqa.toolkit.js?key=CI6VvHdudeE9WTpCx0ptrvgzJGSiOYYW"></script>

    <script type="text/javascript" src="//www.mapquestapi.com/sdk/leaflet/v2.s/mq-map.js?key=CI6VvHdudeE9WTpCx0ptrvgzJGSiOYYW"></script>
    <script type="text/javascript" src="//www.mapquestapi.com/sdk/leaflet/v2.s/mq-routing.js?key=CI6VvHdudeE9WTpCx0ptrvgzJGSiOYYW"></script>


    <script src="js/leaflet.geocsv-src.js"></script>

    <script type="text/javascript" src="maps/potholeMarkers.js"></script>
    <script type="text/javascript" src="maps/testing.js"></script>-->

    <script type="text/javascript" src="maps/potholeMarkers.js"></script>


    <script type="text/javascript">
        "use strict";

        var L, map, MQ, idx = 0, cps, rl;


        function init() {

            map = L.map('map', {
                layers: MQ.mapLayer(),
                center: [29.951065, -90.071533],
                zoom: 13
            });

            L.control.scale().addTo(map);

            /*var mcg = L.markerClusterGroup({
                    maxClusterRadius: 40 }),
                group1 = L.featureGroup.subGroup(mcg),
                group2 = L.featureGroup.subGroup(mcg),
                group3 = L.featureGroup.subGroup(mcg),
                group4 = L.featureGroup.subGroup(mcg),
                control = L.control.layers(null, null, { collapsed: false }),
                i, marker;

            mcg.addTo(map);

            for (i = 0; i < markers.length; i++){
                marker = L.marker([markers[i].lat, markers[i].lng]);
                marker.addTo(i < quarterCount ? group1 : i < quarterCount * 2 ? group2 : i < quarterCount * 3 ? group3 : group4)
            }


            control.addOverlay(group1, 'First quarter');
            control.addOverlay(group2, 'Second quarter');
            control.addOverlay(group3, 'Third quarter');
            control.addOverlay(group4, 'Fourth quarter');
            //control.addOverlay(mqrl, 'Route');
            control.addTo(map);

            group1.addTo(map); // Adding to map now adds all child layers into the parent group.
            group2.addTo(map);
            group3.addTo(map);
            group4.addTo(map);

             document.getElementById("add").addEventListener("click", function () {
             map.addLayer(mcg);
             });

             document.getElementById("remove").addEventListener("click", function () {
             map.removeLayer(mcg);
             });



             /*
            CONTROL POINTS AFTER INITIAL MARKER CLUSTER LAYER
             */

            cps = new L.layerGroup();
            cps.addTo(map);


            //CONVERT TO CIRCLES THEN do below functions
            //documentation from markerclusters -- getChildCount

            map.on('click', function(e) {

                var c = L.circle(
                    [e.latlng.lat, e.latlng.lng],
                    100,
                    {
                        id: idx,
                        cweight: 100,
                        color: 'black',
                        fillColor: 'red',
                        opacity: 1,
                        fillOpacity: 0.5
                    }
                ).addTo(cps);
                c.on('click', function(e) {

                    var r = e.target.getRadius(), w = e.target.options.fillOpacity;
                    var t = "<nobr>Radius:<select onchange='changepar(" +
                        cps.getLayerId(c) + ", \"r\", this[selectedIndex].value);'>" +
                        "<option";
                    if (r === 80.46600000000001) {
                        t = t + " selected='selected'";
                    }
                    t = t + ">0.1</option>" +
                        "<option";
                    if (r === 400) {
                        t = t + " selected='selected'";
                    }
                    t = t + ">0.5</option>" +
                        "<option";
                    if (r === 804.66) {
                        t = t + " selected='selected'";
                    }
                    t = t + ">1</option>" +
                        "<option";
                    if (r === 4023.2999999999997) {
                        t = t + " selected='selected'";
                    }
                    t = t + ">5</option>" +
                        "</select><br/>Weight:<select onchange='changepar(" + cps.getLayerId(c) + ", \"w\", this[selectedIndex].value);'>" +
                        "<option";
                    if (w === 0.125 && e.target.options.fillColor === 'green') {
                        t = t + " selected='selected'";
                    }
                    t = t + ">0.75</option>" +
                        "<option";
                    if (w === 0.25) {
                        t = t + " selected='selected'";
                    }
                    t = t + ">0.5</option>" +
                        "<option";
                    if (w === 0.375) {
                        t = t + " selected='selected'";
                    }
                    t = t + ">0.25</option>" +
                        "<option";
                    if (w === 0.45) {
                        t = t + " selected='selected'";
                    }
                    t = t + ">0.1</option>" +
                        "<option";
                    if (w === 0.01) {
                        t = t + " selected='selected'";
                    }
                    t = t + ">2</option>" +
                        "<option";
                    if (w === 0.025) {
                        t = t + " selected='selected'";
                    }
                    t = t + ">5</option>" +
                        "<option";
                    if (w === 0.125 && e.target.options.fillColor === 'red') {
                        t = t + " selected='selected'";
                    }
                    t = t + ">25</option>" +
                        "<option";
                    if (w === 0.5) {
                        t = t + " selected='selected'";
                    }
                    t = t + ">100</option>" +
                        "</select><br/><input type='button' value='remove' onclick='removepoi(" + cps.getLayerId(c) + ")'/></nobr>";
                    e.target.bindPopup(t).openPopup();
                });
                idx = idx + 1;
            });

        }


        function routeit() {

            var cpc = [], dir = MQ.routing.directions();

            cps.eachLayer(function (d){
                var w = 0;
                if (d.options.fillColor === 'red') {
                    w = d.options.fillOpacity * 200;
                } else {
                    w = 1 - (d.options.fillOpacity * 2)
                }
                cpc.push({
                    lat: d.getLatLng().lat,
                    lng: d.getLatLng().lng,
                    weight: w,
                    radius: (d.getRadius() * 0.001242742)
                });
            });

            dir.route({
                locations: [
                    document.getElementById('orig').value,
                    document.getElementById('dest').value
                ],
                options: {
                    routeControlPointCollection: cpc
                }
            });

            if (rl) {
                map.removeLayer(rl);
            }

            rl = MQ.routing.routeLayer({
                directions: dir,
                fitBounds: true,
                ribbonOptions: {draggable: false}
            });
            map.addLayer(rl);
        }

        function changepar(a, b, c){
            var d = cps.getLayer(a);
            if (b === 'r') {
                d.setRadius(c * 804.66);
            } else {
                d.options.cweight = c;
                if (c < 1) {
                    d.setStyle({fillColor: 'green', opacity: (1 - c), fillOpacity: ((1 - c) / 2)});
                } else {
                    d.setStyle({fillColor: 'red', opacity: (c / 100), fillOpacity: (c / 200)});
                }
            }
        }

        function removepoi(a) {
            cps.removeLayer(cps.getLayer(a));
        }

    </script>
    <style>
        html, body {
            font-family: arial, sans-serif;
        }
        #map {
            width: 800px;
            height: 600px;
        }
    </style>

</head>
<body onload="init();">
<div id="map"></div>
<input id="add" type="button" value="Add MarkerClusterGroup to Map" />
<input id="remove" type="button" value="Remove MarkerClusterGroup from Map" />

<div id="ipt">
    <input type="text" id="orig" value="new orleans, LA"/>
    <input type="text" id="dest" value="metarie, LA"/>
    <input type="button" value="Route" onclick="routeit();"/>


</div>



</body>
</html>
