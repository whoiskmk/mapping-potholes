<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Pothole Clusters</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>

    <script src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-map.js?key=CI6VvHdudeE9WTpCx0ptrvgzJGSiOYYW"></script>
    <script src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-routing.js?key=CI6VvHdudeE9WTpCx0ptrvgzJGSiOYYW"></script>


    <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/MarkerCluster.css" />
    <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/MarkerCluster.Default.css" />

    <script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js'></script>
    <script type='text/javascript' src='http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js'></script>
    <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/leaflet.markercluster.js'></script>

    <script type="text/javascript">
        "use strict";

        var MQ, map, cps, rl;

        function routeit() {
            var cpc = [], dir = MQ.routing.directions();

            cps.eachLayer(function (d){
                var w = 0;
                if (d.options.fillColor === 'red') {
                    w = d.options.fillOpacity * 200;
                } else {
                    w = 1 - (d.options.fillOpacity * 2)
                }
                cpc.push({
                    lat: d.getLatLng().lat,
                    lng: d.getLatLng().lng,
                    weight: w,
                    radius: (d.getRadius() * 0.001242742)
                });
            });

            dir.route({
                locations: [
                    document.getElementById('orig').value,
                    document.getElementById('dest').value
                ],
                options: {
                    routeControlPointCollection: cpc
                }
            });

            if (rl) {
                map.removeLayer(rl);
            }

            rl = MQ.routing.routeLayer({
                directions: dir,
                fitBounds: true,
                ribbonOptions: {draggable: false}
            });
            map.addLayer(rl);
        }

    </script>
</head>

<body>
<div class="container">
    <div class="container">
        <h1>Leaflet Pothole Clusters</h1>

        <p>Here's an interactive map indicating where potholes are located in New Orleans.  The data comes from <a href="https://data.nola.gov/City-Administration/311-Calls-2012-Present-/3iz8-nghx" target="_blank">NOLA.gov</a>.

        <div id="map" style="width: 800px; height: 500px; border: 1px solid #AAA;"></div>
    </div>
</div>

<script type='text/javascript' src='maps/markers.js'></script>
<script type='text/javascript' src='maps/leaf-demo.js'></script>
<script type='text/javascript' src='maps/routeit.js'></script>
<div id="ipt">
    <br>Create a route by hitting the Route button.  Then create control points by clicking the map.  Adjust the control points by clicking the circle for the popup and set the radius, set the weight, or remove the control point.  Then click Route again.</br>
    <input type="text" id="orig" value="new orleans, LA"/>
    <input type="text" id="dest" value="metarie, LA"/>
    <input type="button" value="Route" onclick="routeit();"/>

</div>

</body>
</html>
